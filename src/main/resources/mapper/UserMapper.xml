<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.liao.hw.mbg.mapper.UserMapper">

    <!--后台字段-->
    <sql id="column">
        a.id AS "id",
        a.open_id AS "openId",
        a.union_id AS "unionId",
        a.nick_name AS "nickName",
        a.avatar_url AS "avatarUrl",
        a.gender AS "gender",
        a.city AS "city",
        a.province AS "province",
        a.phone AS "phone",
        a.create_date AS "createDate",
        a.update_date AS "updateDate",
        a.del_flag AS "delFlag"
    </sql>

    <!--api字段-->
    <sql id="column2">
        a.open_id AS "openId",
        a.nick_name AS "nickName",
        a.avatar_url AS "avatarUrl"
    </sql>

    <!--查询是否存在用户，返回id-->
    <select id="findUserByOpenId" resultType="User">
      SELECT
        <include refid="column"></include>
      FROM user a
      WHERE open_id = #{openId}
    </select>

    <insert id="insert">
        INSERT INTO user
        (
          open_id,
          union_id,
          nick_name,
          avatar_url,
          gender,
          city,
          province,
          phone,
          create_date
        ) VALUES (
          #{openId},
          #{unionId},
          #{nickName},
          #{avatarUrl},
          #{gender},
          #{city},
          #{province},
          #{phone},
          NOW()
        )
    </insert>

    <!--存在用户只更新update_date-->
    <update id="updateDate">
        UPDATE user SET update_date = NOW() WHERE id = #{id}
    </update>

    <!--后台更新-->
    <update id="update">
        UPDATE user SET
          open_id = #{openId},
          union_id = #{unionId},
          nick_name = #{nickName},
          avatar_url = #{avatarUrl},
          gender = #{gender},
          city = #{city},
          province = #{province},
          phone = #{phone},
          create_date = #{createDate},
          update_date = NOW()
        WHERE id = #{id}
    </update>


</mapper>